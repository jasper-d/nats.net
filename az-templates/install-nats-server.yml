steps:
- task: Go@0
  displayName: go get github.com/nats-io/nats-server
  inputs:
    arguments: github.com/nats-io/nats-server

- task: CmdLine@2
  displayName: Include nats-server in path (Unix)
  condition: ne(variables['Agent.OS'], 'Windows_NT')
  inputs:
    script: |
      echo "##vso[task.setvariable variable=PATH]$PATH:$GOBIN"


- task: PowerShell@2
  displayName: Include NATS-Server in path (Windows)
  condition: eq(variables['Agent.OS'], 'Windows_NT')
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "GOBIN: $(GOBIN)
      Write-Host "##vso[task.setvariable variable=PATH;]${env:PATH};$(GOBIN)"

- task: CmdLine@2
  displayName: Verify nats-server
  inputs:
    script: |
      nats-server -v

- task: CmdLine@2
  displayName: Verify nats-server.exe
  condition: eq(variables['Agent.OS'], 'Windows_NT')
  inputs:
    script: |
      nats-server.exe -v